{{!-- Dialogue Node Config - Conditions Tab --}}
<div class="tab-content conditions-tab {{theme}}" {{#unless (eq activeTab "conditions")}}hidden{{/unless}}>
  <section class="config-section">
    <div class="section-header">
      <h3>{{localize "DialogueEditor.NodeConditions"}}</h3>
      <button type="button" class="add-btn" data-action="addCondition" data-target="node">
        <i class="fa-solid fa-plus"></i>
        {{localize "DialogueEditor.AddCondition"}}
      </button>
    </div>

    <p class="section-hint">{{localize "DialogueEditor.ConditionsHint"}}</p>

    {{#if conditionsDisplay.length}}
      <div class="conditions-list">
        {{#each conditionsDisplay}}
          <div class="condition-entry" data-index="{{this.index}}">
            <div class="condition-header">
              <span class="condition-type">{{this.typeLabel}}</span>
              <div class="condition-controls">
                <label class="invert-toggle">
                  <input type="checkbox" name="node.conditions.{{this.index}}.inverted" {{#if this.inverted}}checked{{/if}} />
                  {{localize "DialogueEditor.Invert"}}
                </label>
                <button type="button" class="control-btn danger" data-action="removeCondition" data-target="node" data-index="{{this.index}}">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>

            <div class="condition-config">
              <div class="form-group">
                <label>{{localize "DialogueEditor.ConditionType"}}</label>
                <select name="node.conditions.{{this.index}}.type">
                  {{#each ../conditionTypes}}
                    <option value="{{this.value}}" {{#if (eq this.value ../type)}}selected{{/if}}>{{this.label}}</option>
                  {{/each}}
                </select>
              </div>

              {{!-- Flag Condition --}}
              {{#if (eq this.type "flag")}}
                <div class="form-row">
                  <div class="form-group third">
                    <label>{{localize "DialogueEditor.Scope"}}</label>
                    <select name="node.conditions.{{this.index}}.scope">
                      <option value="world" {{#if (eq this.scope "world")}}selected{{/if}}>{{localize "DialogueEditor.ScopeWorld"}}</option>
                      <option value="actor" {{#if (eq this.scope "actor")}}selected{{/if}}>{{localize "DialogueEditor.ScopeActor"}}</option>
                      <option value="npc" {{#if (eq this.scope "npc")}}selected{{/if}}>{{localize "DialogueEditor.ScopeNPC"}}</option>
                    </select>
                  </div>
                  <div class="form-group third">
                    <label>{{localize "DialogueEditor.FlagKey"}}</label>
                    <input type="text" name="node.conditions.{{this.index}}.key" value="{{this.key}}" />
                  </div>
                  <div class="form-group third">
                    <label>{{localize "DialogueEditor.ExpectedValue"}}</label>
                    <input type="text" name="node.conditions.{{this.index}}.value" value="{{this.value}}" />
                  </div>
                </div>
              {{/if}}

              {{!-- Quest Status Condition --}}
              {{#if (eq this.type "quest_status")}}
                <div class="form-row">
                  <div class="form-group half">
                    <label>{{localize "DialogueEditor.QuestID"}}</label>
                    <input type="text" name="node.conditions.{{this.index}}.questId" value="{{this.questId}}" />
                  </div>
                  <div class="form-group half">
                    <label>{{localize "DialogueEditor.RequiredStatus"}}</label>
                    <select name="node.conditions.{{this.index}}.status">
                      <option value="available" {{#if (eq this.status "available")}}selected{{/if}}>{{localize "DialogueEditor.StatusAvailable"}}</option>
                      <option value="active" {{#if (eq this.status "active")}}selected{{/if}}>{{localize "DialogueEditor.StatusActive"}}</option>
                      <option value="completed" {{#if (eq this.status "completed")}}selected{{/if}}>{{localize "DialogueEditor.StatusCompleted"}}</option>
                      <option value="failed" {{#if (eq this.status "failed")}}selected{{/if}}>{{localize "DialogueEditor.StatusFailed"}}</option>
                    </select>
                  </div>
                </div>
              {{/if}}

              {{!-- Player Level Condition --}}
              {{#if (eq this.type "player_level")}}
                <div class="form-row">
                  <div class="form-group half">
                    <label>{{localize "DialogueEditor.Comparison"}}</label>
                    <select name="node.conditions.{{this.index}}.comparison">
                      <option value="gte" {{#if (eq this.comparison "gte")}}selected{{/if}}>&ge;</option>
                      <option value="gt" {{#if (eq this.comparison "gt")}}selected{{/if}}>&gt;</option>
                      <option value="eq" {{#if (eq this.comparison "eq")}}selected{{/if}}>=</option>
                      <option value="lt" {{#if (eq this.comparison "lt")}}selected{{/if}}>&lt;</option>
                      <option value="lte" {{#if (eq this.comparison "lte")}}selected{{/if}}>&le;</option>
                    </select>
                  </div>
                  <div class="form-group half">
                    <label>{{localize "DialogueEditor.Level"}}</label>
                    <input type="number" name="node.conditions.{{this.index}}.value" value="{{this.value}}" min="1" max="20" />
                  </div>
                </div>
              {{/if}}

              {{!-- Has Gold Condition --}}
              {{#if (eq this.type "has_gold")}}
                <div class="form-group">
                  <label>{{localize "DialogueEditor.MinimumGold"}}</label>
                  <input type="number" name="node.conditions.{{this.index}}.amount" value="{{this.amount}}" min="0" />
                </div>
              {{/if}}

              {{!-- Has Item Condition --}}
              {{#if (eq this.type "has_item")}}
                <div class="form-row">
                  <div class="form-group two-thirds">
                    <label>{{localize "DialogueEditor.ItemID"}}</label>
                    <input type="text" name="node.conditions.{{this.index}}.itemId" value="{{this.itemId}}" />
                  </div>
                  <div class="form-group third">
                    <label>{{localize "DialogueEditor.Quantity"}}</label>
                    <input type="number" name="node.conditions.{{this.index}}.quantity" value="{{this.quantity}}" min="1" />
                  </div>
                </div>
              {{/if}}

              {{!-- Random Condition --}}
              {{#if (eq this.type "random")}}
                <div class="form-group">
                  <label>{{localize "DialogueEditor.Chance"}} (0-1)</label>
                  <input type="number" name="node.conditions.{{this.index}}.chance" value="{{this.chance}}" min="0" max="1" step="0.1" />
                </div>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </div>
    {{else}}
      <div class="empty-state">
        <i class="fa-solid fa-filter"></i>
        <p>{{localize "DialogueEditor.NoConditions"}}</p>
        <p class="hint">{{localize "DialogueEditor.NoConditionsHint"}}</p>
      </div>
    {{/if}}
  </section>
</div>
